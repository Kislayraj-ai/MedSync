{% extends layout_path %}
{% load static %}
{% load i18n %}

{% block title %}{{ page_title }} {% endblock %}

{% block vendor_css %}
{{ block.super }}
  <link rel="stylesheet" href="{% static 'vendor/libs/apex-charts/apex-charts.css' %}" />
  <link rel="stylesheet" href="{% static "css/common.css" %}">


  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

<style>
  /* Ensure event elements position children correctly */
  .fc .fc-timegrid-event,
  .fc .fc-daygrid-event {
    position: relative;
    overflow: hidden;
  }

  /* Nice, compact edit button inside event */
  .fc-event-main{
    display:flex :
    flex-direction :column;
  }
  .fc-event-edit {
    width: 1--%;%
    {% comment %} position: absolute;
    top: 4px;
    right: 4px;
    padding: 2px 8px; {% endcomment %}
    font-size: 11px;
    line-height: 1.2;
    border-radius: 6px;
    border: 0;
    background: #f6f6f6ff; /* orange */
    color: #2c2c2cff;
    cursor: pointer;
    box-shadow: 0 1px 2px rgba(0,0,0,.15);
  }

  /* Optional: make short events a bit taller for button comfort */
  .fc .fc-timegrid .fc-v-event { min-height: 34px; }
  .fc-event-edit, .fc-event-cancel {
  border: none;
  background: transparent;
  cursor: pointer;
  font-size: 14px;
  color: #fff;  /* white for visibility on colored events */
}
.card {
  overflow: visible !important;
}

.card-header {
  z-index: 10; 
  position: relative;
}


</style>

{% endblock vendor_css %}

{% block content %}

        <div class="row mb-4">
          <div class="col-12">
            <div class="card shadow-sm border-0 rounded-3">
              <div class="card-header bg-white border-0 pb-0">
                <h4 class="mb-0 d-flex align-items-center">
                  <i class="bx bx-calendar-event text-primary fs-4 me-2"></i>
                  Appointment Calendar
                </h4>
              </div>
              <div class="card-body mt-2">
                <div class="row g-3">
                  <!-- Select Clinic -->
                  <div class="col-md-4">
                    <label for="clinic" class="form-label fw-semibold">
                      <i class="bx bx-building-house me-1 text-muted"></i> Clinic
                    </label>
                    <select name="clinic" id="clinic" class="form-select">
                      <option value="">Choose Clinic</option>
                    </select>
                  </div>

                  <!-- Select Doctor -->
                  <div class="col-md-4">
                    <label for="doctor" class="form-label fw-semibold">
                      <i class="bx bx-user-md me-1 text-muted"></i> Doctor
                    </label>
                    <select name="doctor" id="doctor" class="form-select">
                      <option value="">Choose Doctor</option>
                    </select>
                  </div>

                  <!-- Select Patient -->
                  <div class="col-md-4">
                    <label for="patient_select" class="form-label fw-semibold">
                      <i class="bx bx-user me-1 text-muted"></i> Patient
                    </label>
                    <select name="patient" id="patient" class="form-select">
                      <option value="">Choose patient</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>


                  {% for msg in messages %}
                {% if msg.tags == "success" %}
                    <div class="alert alert-success">
                {% elif msg.tags == "error" %}
                    <div class="alert alert-danger">
                {% else %}
                    <div class="alert alert-info">
                {% endif %}
                    {{ msg }}
                    </div>
                {% endfor %}
                
  <div id="calendar"></div>



<div class="modal fade" id="slotModal" tabindex="-1" aria-labelledby="slotModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content w-100">
      <div class="modal-header p-4">
        <h5 class="modal-title" id="slotModalLabel">Check Slot Availability</h5>
      </div>

      <div class="modal-body">
      
        <p>Note: Continue to appointment page or click on close.</p>
      </div>

      <div class="modal-footer d-flex justify-content-center gap-2">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" id="confirmSlot" class="btn btn-info">Continue</button>
      </div>
    </div>
  </div>
</div>


{% endblock %}


{% block page_js %}
{{ block.super }}

<script>
   let GET_BASE_URL = "{{ BASE_URL }}";
</script>

{% comment %} <script src="{% static 'vendor/libs/fullcalendar/index.global.min.js' %}"></script> {% endcomment %}
<script src="{% static 'vendor/libs/@fullcalendar/core/index.global.min.js' %}"></script>
<script src="{% static 'vendor/libs/@fullcalendar/daygrid/index.global.min.js' %}"></script>
<script src="{% static 'vendor/libs/@fullcalendar/timegrid/index.global.min.js' %}"></script>
<script src="{% static 'vendor/libs/@fullcalendar/interaction/index.global.min.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
{% comment %} static  {% endcomment %}
<script>

    $(document).ready(()=>{


       $('#clinic').select2({
            placeholder : 'Choose Clinic' ,
            width: '100%' ,
            dropdownParent: $('.card') 
        })
        
        $('#doctor').select2({
            placeholder : 'Choose Doctor' ,
            width: '100%' ,
            dropdownParent: $('.card') 
        })

        $('#patient').select2({
            placeholder : 'Choose Patient' ,
            width: '100%' ,
            dropdownParent: $('.card') 
        })
        

            const fetchPatients = (clinicid=0) =>{
            $.ajax({
                url : `${GET_BASE_URL}/api/v1/patients` ,
                  type : "GET" ,
                  data :{
                    clinicid
                  },
                  success : (data) =>{

                      $('#patient').append(
                              new Option('Choose Patient', '', false, false)
                      )

                      data.forEach((item)=>{
                        $('#patient').append(
                            new Option(`${item.firstname} ${item.lastname}`, item.userid, false, false)
                        )
                    })
                  }
              })
          }

       // fetchPatients()
        
        const fetchDoctors = (getclinicid) =>{
            $.ajax({
                url : `${GET_BASE_URL}/api/v1/doctors` ,
                type : "GET" ,
                data : { clinicid: getclinicid  } ,
                success : (data) =>{

                  $('#doctor').empty();

                      $('#doctor').append(
                            new Option("Select Doctor", 0 , false, false)
                      )
                    data.forEach((item)=>{
                     // console.log("get", item)
                        $('#doctor').append(
                            new Option(`${item.first_name} ${item.last_name}`, item.id, false, false)
                        )
                    })

                }
            })
        }


        const fetchClinic = () =>{

            $.ajax({
                url : `${GET_BASE_URL}/api/v1/clinics` ,
                type : "GET" ,
                success : (data) =>{
                    //console.log(data)
                  
                  $('#clinic').empty();

                  // Default option add karo
                  $('#clinic').append(
                      new Option("Select Clinic", "", false, false)
                  );

                    data.forEach((item)=>{
                        $('#clinic').append(
                            new Option(item.name, item.id, false, false)
                        )
                    })

                }
            })

            $(document).find('#clinic').on('change' , (e)=>{
                let getid =  $(e.target).val()
                fetchDoctors(getid)
                fetchPatients(getid)
            })
        }
        

        fetchClinic()
    })
</script>


<script src="{% static "custom/calender.js" %}?v=1.8"></script>


{% endblock  %}